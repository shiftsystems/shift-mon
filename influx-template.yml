apiVersion: influxdata.com/v2alpha1
kind: Label
metadata:
    name: terrifying-tu-cfc001
spec:
    color: '#9bf445'
    name: shift-rmm
---
apiVersion: influxdata.com/v2alpha1
kind: Bucket
metadata:
    name: beautiful-cohen-cfc009
spec:
    associations:
      - kind: Label
        name: terrifying-tu-cfc001
    name: pfsense
    retentionRules:
      - everySeconds: 1.2096e+06
        type: expire
---
apiVersion: influxdata.com/v2alpha1
kind: Bucket
metadata:
    name: fasting-moore-cfc011
spec:
    associations:
      - kind: Label
        name: terrifying-tu-cfc001
    name: windows
    retentionRules:
      - everySeconds: 1.2096e+06
        type: expire
---
apiVersion: influxdata.com/v2alpha1
kind: Bucket
metadata:
    name: heuristic-goldstine-cfc00d
spec:
    associations:
      - kind: Label
        name: terrifying-tu-cfc001
    name: proxmox
    retentionRules:
      - everySeconds: 1.2096e+06
        type: expire
---
apiVersion: influxdata.com/v2alpha1
kind: Bucket
metadata:
    name: nifty-brahmagupta-cfc005
spec:
    associations:
      - kind: Label
        name: terrifying-tu-cfc001
    name: linux
    retentionRules:
      - everySeconds: 1.2096e+06
        type: expire
---
apiVersion: influxdata.com/v2alpha1
kind: CheckDeadman
metadata:
    name: beautiful-sanderson-4fc009
spec:
    associations:
      - kind: Label
        name: terrifying-tu-cfc001
    every: 1m0s
    level: CRIT
    name: Windows Host Down
    query: |-
        from(bucket: "windows")
          |> range(start: v.timeRangeStart, stop: v.timeRangeStop)
          |> filter(fn: (r) => r["_measurement"] == "system")
          |> filter(fn: (r) => r["_field"] == "load15")undefined
    staleTime: 10m0s
    status: active
    statusMessageTemplate: 'Check: ${ r._check_name } is: ${ r._level } on ${r.host}'
    timeSince: 5m0s
---
apiVersion: influxdata.com/v2alpha1
kind: CheckDeadman
metadata:
    name: objective-mestorf-0fc019
spec:
    associations:
      - kind: Label
        name: terrifying-tu-cfc001
    every: 1m0s
    level: CRIT
    name: Proxmox Node Down
    query: |-
        from(bucket: "proxmox")
          |> range(start: v.timeRangeStart, stop: v.timeRangeStop)
          |> filter(fn: (r) => r["_measurement"] == "cpustat")
          |> filter(fn: (r) => r["_field"] == "avg5")
    staleTime: 10m0s
    status: active
    statusMessageTemplate: 'Check: ${ r._check_name } is: ${ r._level } on ${r.host}'
    timeSince: 5m0s
---
apiVersion: influxdata.com/v2alpha1
kind: CheckDeadman
metadata:
    name: realistic-mestorf-0fc011
spec:
    associations:
      - kind: Label
        name: terrifying-tu-cfc001
    every: 15m0s
    level: CRIT
    name: Pfsense Host Down
    query: |-
        from(bucket: "pfsense")
          |> range(start: v.timeRangeStart, stop: v.timeRangeStop)
          |> filter(fn: (r) => r["_measurement"] == "system")
          |> filter(fn: (r) => r["_field"] == "load5")
    staleTime: 10m0s
    status: active
    statusMessageTemplate: 'Check: ${ r._check_name } is: ${ r._level } on ${r.host}'
    timeSince: 1m30s
---
apiVersion: influxdata.com/v2alpha1
kind: CheckThreshold
metadata:
    name: crumbling-roentgen-0fc009
spec:
    associations:
      - kind: Label
        name: terrifying-tu-cfc001
    every: 15m0s
    name: Pfsense High CPU Usage
    query: |-
        from(bucket: "pfsense")
          |> range(start: v.timeRangeStart, stop: v.timeRangeStop)
          |> filter(fn: (r) => r["_measurement"] == "cpu")
          |> filter(fn: (r) => r["_field"] == "usage_idle")
          |> aggregateWindow(every: 1m, fn: mean, createEmpty: false)
          |> yield(name: "mean")
    status: active
    statusMessageTemplate: 'Check: ${ r._check_name } is: ${ r._level } on host ${r.host} '
    thresholds:
      - level: CRIT
        type: lesser
        value: 10
      - level: WARN
        type: lesser
        value: 25
---
apiVersion: influxdata.com/v2alpha1
kind: CheckThreshold
metadata:
    name: elastic-pascal-4fc001
spec:
    associations:
      - kind: Label
        name: terrifying-tu-cfc001
    every: 5m0s
    name: Windows High CPU Usage
    query: |-
        from(bucket: "windows")
          |> range(start: v.timeRangeStart, stop: v.timeRangeStop)
          |> filter(fn: (r) => r["_measurement"] == "cpu")
          |> filter(fn: (r) => r["_field"] == "usage_idle")
          |> aggregateWindow(every: 1m, fn: mean, createEmpty: false)
          |> yield(name: "mean")
    status: active
    statusMessageTemplate: 'Check: ${ r._check_name } is: ${ r._level } on ${r.host}'
    thresholds:
      - level: CRIT
        type: lesser
        value: 10
      - level: WARN
        type: lesser
        value: 25
---
apiVersion: influxdata.com/v2alpha1
kind: CheckThreshold
metadata:
    name: elastic-tharp-cfc015
spec:
    associations:
      - kind: Label
        name: terrifying-tu-cfc001
    every: 15m0s
    name: Ansible pull failed
    query: |-
        from(bucket: "linux")
          |> range(start: v.timeRangeStart, stop: v.timeRangeStop)
          |> filter(fn: (r) => r["_measurement"] == "systemd_units")
          |> filter(fn: (r) => r["_field"] == "active_code")
          |> filter(fn: (r) => r["active"] == "failed")
          |> filter(fn: (r) => r["name"] == "ansible-pull@base.service")
          |> aggregateWindow(every: 1m, fn: mean)
          |> yield(name: "mean")
    status: active
    statusMessageTemplate: 'Check: ${ r._check_name } is: ${ r._level } on ${r.host}'
    thresholds:
      - level: WARN
        type: greater
        value: 1
---
apiVersion: influxdata.com/v2alpha1
kind: CheckThreshold
metadata:
    name: pensive-curran-0fc015
spec:
    associations:
      - kind: Label
        name: terrifying-tu-cfc001
    every: 10m0s
    name: Pfsense Low disk Space
    query: |-
        from(bucket: "pfsense")
          |> range(start: v.timeRangeStart, stop: v.timeRangeStop)
          |> filter(fn: (r) => r["_measurement"] == "disk")
          |> filter(fn: (r) => r["_field"] == "used_percent")
          |> filter(fn: (r) => r["path"] == "/")
          |> aggregateWindow(every: 1m, fn: mean, createEmpty: false)
          |> yield(name: "mean")
    status: active
    statusMessageTemplate: 'Check: ${ r._check_name } is: ${ r._level } on host ${r.host} '
    thresholds:
      - level: CRIT
        type: greater
        value: 90
      - level: WARN
        type: greater
        value: 70
---
apiVersion: influxdata.com/v2alpha1
kind: CheckThreshold
metadata:
    name: quirky-elbakyan-0fc005
spec:
    associations:
      - kind: Label
        name: terrifying-tu-cfc001
    every: 10m0s
    name: Linux Low Disk Space
    query: |-
        from(bucket: "linux")
          |> range(start: v.timeRangeStart, stop: v.timeRangeStop)
          |> filter(fn: (r) => r["_measurement"] == "disk")
          |> filter(fn: (r) => r["_field"] == "used_percent")
          |> aggregateWindow(every: 1m, fn: mean, createEmpty: false)
          |> yield(name: "mean")
    status: active
    statusMessageTemplate: 'Check: ${ r._check_name } is: ${ r._level } on host ${r.host} '
    thresholds:
      - level: CRIT
        type: greater
        value: 90
      - level: WARN
        type: greater
        value: 70
---
apiVersion: influxdata.com/v2alpha1
kind: CheckThreshold
metadata:
    name: rustic-golick-4fc005
spec:
    associations:
      - kind: Label
        name: terrifying-tu-cfc001
    every: 15m0s
    name: Windows High Ram Usage
    query: |-
        from(bucket: "windows")
          |> range(start: v.timeRangeStart, stop: v.timeRangeStop)
          |> filter(fn: (r) => r["_measurement"] == "mem")
          |> filter(fn: (r) => r["_field"] == "used_percent")
          |> aggregateWindow(every: 1, fn: mean, createEmpty: false)
          |> yield(name: "mean")
    status: active
    statusMessageTemplate: 'Check: ${ r._check_name } is: ${ r._level } on ${r.host}'
    thresholds:
      - level: CRIT
        type: greater
        value: 90
---
apiVersion: influxdata.com/v2alpha1
kind: CheckThreshold
metadata:
    name: rustling-murdock-0fc001
spec:
    associations:
      - kind: Label
        name: terrifying-tu-cfc001
    every: 10m0s
    name: Linux High Ram Usage
    query: |-
        from(bucket: "linux")
          |> range(start: v.timeRangeStart, stop: v.timeRangeStop)
          |> filter(fn: (r) => r["_measurement"] == "mem")
          |> filter(fn: (r) => r["_field"] == "used_percent")
          |> aggregateWindow(every: 1m, fn: mean, createEmpty: false)
          |> yield(name: "mean")
    status: active
    statusMessageTemplate: 'Check: ${ r._check_name } is: ${ r._level } on host ${r.host} '
    thresholds:
      - level: CRIT
        type: greater
        value: 90
---
apiVersion: influxdata.com/v2alpha1
kind: CheckThreshold
metadata:
    name: sad-turing-0fc00d
spec:
    associations:
      - kind: Label
        name: terrifying-tu-cfc001
    every: 15m0s
    name: Pfsense High Ram Usage
    query: |-
        from(bucket: "pfsense")
          |> range(start: v.timeRangeStart, stop: v.timeRangeStop)
          |> filter(fn: (r) => r["_measurement"] == "mem")
          |> filter(fn: (r) => r["_field"] == "used_percent")
          |> aggregateWindow(every: 1m, fn: mean, createEmpty: false)
          |> yield(name: "mean")
    status: active
    statusMessageTemplate: 'Check: ${ r._check_name } is: ${ r._level } on host ${r.host} '
    thresholds:
      - level: CRIT
        type: greater
        value: 90
---
apiVersion: influxdata.com/v2alpha1
kind: CheckThreshold
metadata:
    name: stoic-herschel-4fc00d
spec:
    associations:
      - kind: Label
        name: terrifying-tu-cfc001
    every: 5m0s
    name: Windows Low Disk Space
    query: |-
        from(bucket: "windows")
          |> range(start: v.timeRangeStart, stop: v.timeRangeStop)
          |> filter(fn: (r) => r["_measurement"] == "disk")
          |> filter(fn: (r) => r["host"] == "CARTER-AIO")
          |> filter(fn: (r) => r["_field"] == "used_percent")
          |> aggregateWindow(every: 1, fn: last, createEmpty: false)
          |> yield(name: "last")
    status: active
    statusMessageTemplate: 'Check: ${ r._check_name } is: ${ r._level } on ${r.host}'
    thresholds:
      - level: CRIT
        type: greater
        value: 90
      - level: WARN
        type: greater
        value: 70
---
apiVersion: influxdata.com/v2alpha1
kind: CheckThreshold
metadata:
    name: toasty-vaughan-cfc019
spec:
    associations:
      - kind: Label
        name: terrifying-tu-cfc001
    every: 15m0s
    name: Linux High CPU Usage
    query: |-
        from(bucket: "linux")
          |> range(start: v.timeRangeStart, stop: v.timeRangeStop)
          |> filter(fn: (r) => r["_measurement"] == "cpu")
          |> filter(fn: (r) => r["_field"] == "usage_idle")
          |> aggregateWindow(every: 1m, fn: mean, createEmpty: false)
          |> yield(name: "mean")
    status: active
    statusMessageTemplate: 'Check: ${ r._check_name } is: ${ r._level } on ${r.host}'
    thresholds:
      - level: CRIT
        type: lesser
        value: 10
      - level: WARN
        type: lesser
        value: 25
---
apiVersion: influxdata.com/v2alpha1
kind: NotificationEndpointPagerDuty
metadata:
    name: suspicious-kapitsa-4fc011
spec:
    associations:
      - kind: Label
        name: terrifying-tu-cfc001
    name: Shift Pager Duty
    routingKey:
        secretRef:
            key: 0665d95e01d6e000-routing-key
    status: active
    url: https://mon.shiftsystems.net:9999/orgs/1340c3d9f235c3e2/alert-history
---
apiVersion: influxdata.com/v2alpha1
kind: NotificationRule
metadata:
    name: keen-greider-4fc013
spec:
    associations:
      - kind: Label
        name: terrifying-tu-cfc001
    endpointName: suspicious-kapitsa-4fc011
    every: 5m0s
    messageTemplate: 'Notification Rule: ${ r._notification_rule_name } triggered
        by check: ${ r._check_name }: ${ r._message }'
    name: Critical
    statusRules:
      - currentLevel: CRIT
---
apiVersion: influxdata.com/v2alpha1
kind: NotificationRule
metadata:
    name: righteous-pike-4fc017
spec:
    associations:
      - kind: Label
        name: terrifying-tu-cfc001
    endpointName: suspicious-kapitsa-4fc011
    every: 5m0s
    messageTemplate: 'Notification Rule: ${ r._notification_rule_name } triggered
        by check: ${ r._check_name }: ${ r._message }'
    name: Warnings
    statusRules:
      - currentLevel: WARN
---
apiVersion: influxdata.com/v2alpha1
kind: Variable
metadata:
    name: admiring-dijkstra-4fc01b
spec:
    associations:
      - kind: Label
        name: terrifying-tu-cfc001
    language: flux
    name: interface
    query: |-
        from(bucket: v.bucket)
          |> range(start: v.timeRangeStart, stop: v.timeRangeStop)
          |> filter(fn: (r) => r["_measurement"] == "net")
          |> filter(fn: (r) => r["host"] == v.hostname)
          |> filter(fn: (r) => r["_field"] == "bytes_recv")
          |> keyValues(keyColumns: ["interface"])
          |> keep(columns: ["_value"])
    type: query
---
apiVersion: influxdata.com/v2alpha1
kind: Variable
metadata:
    name: burfect-fermat-4fc023
spec:
    associations:
      - kind: Label
        name: terrifying-tu-cfc001
    name: mesh_info
    type: map
    values:
        mesh_domain: test.example.com
---
apiVersion: influxdata.com/v2alpha1
kind: Variable
metadata:
    name: elated-pike-4fc01f
spec:
    associations:
      - kind: Label
        name: terrifying-tu-cfc001
    language: flux
    name: pve_node
    query: |-
        from(bucket: v.bucket)
          |> range(start: v.timeRangeStart, stop: v.timeRangeStop)
          |> filter(fn: (r) => r["object"] == "nodes")
          |> filter(fn: (r) => r["object"] == "nodes")
          |> keyValues(keyColumns: ["host"])
          |> keep(columns: ["_value"])
    type: query
---
apiVersion: influxdata.com/v2alpha1
kind: Variable
metadata:
    name: naughty-volhard-8fc005
spec:
    associations:
      - kind: Label
        name: terrifying-tu-cfc001
    language: flux
    name: bucket
    query: |-
        buckets()
          |> filter(fn: (r) => r.name !~ /^_/)
          |> rename(columns: {name: "_value"})
          |> keep(columns: ["_value"])
    type: query
---
apiVersion: influxdata.com/v2alpha1
kind: Variable
metadata:
    name: youthful-poincare-8fc001
spec:
    associations:
      - kind: Label
        name: terrifying-tu-cfc001
    language: flux
    name: hostname
    query: |-
        from(bucket: v.bucket)
          |> range(start: v.timeRangeStart, stop: v.timeRangeStop)
          |> filter(fn: (r) => r["_measurement"] == "system")
          |> filter(fn: (r) => r["_field"] == "uptime")
          |> keyValues(keyColumns: ["host"])
          |> keep(columns: ["_value"])
    type: query
---
apiVersion: influxdata.com/v2alpha1
kind: Dashboard
metadata:
    name: naughty-torvalds-4fc001
spec:
    associations:
      - kind: Label
        name: terrifying-tu-cfc001
    charts:
      - axes:
          - base: "10"
            name: x
            scale: linear
          - base: "10"
            name: y
            scale: linear
        colors:
          - hex: '#00C9FF'
            name: laser
            type: text
        decimalPlaces: 2
        height: 3
        kind: Single_Stat_Plus_Line
        name: CPU usage
        position: overlaid
        queries:
          - query: "from(bucket: v.bucket)\n  |> range(start: v.timeRangeStart, stop:
                v.timeRangeStop)\n  |> filter(fn: (r) => r[\"_measurement\"] == \"cpu\")\n
                \ |> filter(fn: (r) => r[\"host\"] == v.hostname)\n  |> filter(fn:
                (r) => r[\"cpu\"] == \"cpu-total\")\n  |> filter(fn: (r) => r[\"_field\"]
                == \"usage_idle\")\n  |> map(fn: (r) => ({\n      r with \n      _value:
                100.0 - r._value\n      })\n  )"
        width: 5
        xCol: _time
        yCol: _value
      - axes:
          - base: "10"
            name: x
            scale: linear
          - label: bandwidth in Kbit/s
            name: y
            scale: linear
        colors:
          - hex: '#00C9FF'
            name: laser
            type: text
        decimalPlaces: 2
        height: 3
        kind: Single_Stat_Plus_Line
        name: Outbound Traffic
        position: overlaid
        queries:
          - query: |-
                from(bucket: v.bucket)
                  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)
                  |> filter(fn: (r) => r["_measurement"] == "net")
                  |> filter(fn: (r) => r["_field"] == "bytes_sent")
                  |> filter(fn: (r) => r["host"] == v.hostname)
                  |> filter(fn: (r) => r["interface"] == v.interface)
                  |> map(fn: (r) => ({
                      r with
                      _value: r._value / 125
                    })
                  )
                  |> derivative(unit: 1s, nonNegative: false)
                  |> yield(name: "derivative")
                  |> last()
        suffix: ' kbit/s'
        width: 3
        xCol: _time
        yCol: _value
        yPos: 3
      - colors:
          - hex: '#ffffff'
            name: white
            type: text
        fieldOptions:
          - displayName: class
            fieldName: class
            visible: true
          - displayName: protocol
            fieldName: protocol
            visible: true
          - displayName: src_port
            fieldName: src_port
            visible: true
          - displayName: src_ip
            fieldName: src_ip
            visible: true
          - displayName: dest_port
            fieldName: dest_port
            visible: true
          - displayName: dest_ip
            fieldName: dest_ip
            visible: true
          - displayName: _time
            fieldName: _time
            visible: true
          - displayName: _start
            fieldName: _start
            visible: true
          - displayName: _stop
            fieldName: _stop
            visible: true
          - displayName: _measurement
            fieldName: _measurement
            visible: true
          - displayName: host
            fieldName: host
            visible: true
          - displayName: path
            fieldName: path
            visible: true
        height: 4
        kind: Table
        name: Snort
        queries:
          - query: |-
                from(bucket: v.bucket)
                  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)
                  |> filter(fn: (r) => r["_measurement"] == "tail_snort_alerts")
                  |> filter(fn: (r) => r["_field"] == "src_port" or r["_field"] == "dest_port")
                  |> filter(fn: (r) => r["host"] == v.hostname)
                  |> pivot(rowKey:["_time"], columnKey: ["_field"], valueColumn: "_value")
                  |> group()
                  |> keep(columns: ["class","dest_ip","dest_port","src_ip","src_port","protocol"])
        tableOptions:
            verticalTimeAxis: true
        timeFormat: YYYY-MM-DD HH:mm:ss
        width: 6
        yPos: 6
      - axes:
          - base: "10"
            name: x
            scale: linear
          - base: "10"
            name: y
            scale: linear
        colors:
          - hex: '#00C9FF'
            name: laser
            type: text
        decimalPlaces: 2
        height: 3
        kind: Single_Stat_Plus_Line
        name: Inbound traffic
        position: overlaid
        queries:
          - query: |-
                from(bucket: v.bucket)
                  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)
                  |> filter(fn: (r) => r["_measurement"] == "net")
                  |> filter(fn: (r) => r["_field"] == "bytes_recv")
                  |> filter(fn: (r) => r["host"] == v.hostname)
                  |> filter(fn: (r) => r["interface"] == v.interface)
                  |> map(fn: (r) => ({
                      r with
                      _value: r._value / 125
                    })
                  )
                  |> derivative(unit: 1s, nonNegative: false)
                  |> yield(name: "derivative")
                  |> last()
        suffix: ' kbit/s'
        width: 3
        xCol: _time
        xPos: 3
        yCol: _value
        yPos: 3
      - axes:
          - base: "10"
            name: x
            scale: linear
          - base: "10"
            name: y
            scale: linear
        colors:
          - hex: '#00C9FF'
            name: laser
            type: text
        decimalPlaces: 2
        height: 3
        kind: Single_Stat_Plus_Line
        name: Ram usage
        position: overlaid
        queries:
          - query: |-
                from(bucket: v.bucket)
                  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)
                  |> filter(fn: (r) => r["_measurement"] == "mem")
                  |> filter(fn: (r) => r["_field"] == "used_percent")
                  |> filter(fn: (r) => r["host"] == v.hostname)
        width: 5
        xCol: _time
        xPos: 5
        yCol: _value
      - colors:
          - hex: '#ffffff'
            name: white
            type: text
        fieldOptions:
          - displayName: _start
            fieldName: _start
            visible: true
          - displayName: _stop
            fieldName: _stop
            visible: true
          - displayName: _time
            fieldName: _time
            visible: true
          - displayName: _value
            fieldName: _value
            visible: true
          - displayName: DstIP
            fieldName: DstIP
            visible: true
          - displayName: FeedName
            fieldName: FeedName
            visible: true
          - displayName: GeoIP
            fieldName: GeoIP
            visible: true
          - displayName: SrcIP
            fieldName: SrcIP
            visible: true
          - displayName: _field
            fieldName: _field
            visible: true
          - displayName: _measurement
            fieldName: _measurement
            visible: true
          - displayName: host
            fieldName: host
            visible: true
          - displayName: path
            fieldName: path
            visible: true
          - displayName: count
            fieldName: count
            visible: true
        height: 3
        kind: Table
        name: Top Blocked Countries
        queries:
          - query: |-
                from(bucket: v.bucket)
                  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)
                  |> filter(fn: (r) => r["host"] == v.hostname)
                  |> filter(fn: (r) => r["_measurement"] == "tail_ipblock")
                  |> filter(fn: (r) => r["_field"] == "action")
                  |> group(columns: ["GeoIP"], mode:"by")
                  |> count()
                  |> group()
                  |> limit(n:20, offset: 0)
                  |> drop(columns: ["_start", "_stop"])
                  |> rename(columns: {_value: "count"})
        tableOptions:
            verticalTimeAxis: true
        timeFormat: YYYY-MM-DD HH:mm:ss
        width: 2
        xPos: 6
        yPos: 3
      - colors:
          - hex: '#ffffff'
            name: white
            type: text
        fieldOptions:
          - displayName: _start
            fieldName: _start
            visible: true
          - displayName: _stop
            fieldName: _stop
            visible: true
          - displayName: _time
            fieldName: _time
            visible: true
          - displayName: _value
            fieldName: _value
            visible: true
          - displayName: DstIP
            fieldName: DstIP
            visible: true
          - displayName: FeedName
            fieldName: FeedName
            visible: true
          - displayName: GeoIP
            fieldName: GeoIP
            visible: true
          - displayName: SrcIP
            fieldName: SrcIP
            visible: true
          - displayName: _field
            fieldName: _field
            visible: true
          - displayName: _measurement
            fieldName: _measurement
            visible: true
          - displayName: host
            fieldName: host
            visible: true
          - displayName: path
            fieldName: path
            visible: true
          - displayName: count
            fieldName: count
            visible: true
          - displayName: DestIP
            fieldName: DestIP
            visible: true
        height: 4
        kind: Table
        name: IP Blocks By Feed
        queries:
          - query: |-
                from(bucket: v.bucket)
                  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)
                  |> filter(fn: (r) => r["host"] == v.hostname)
                  |> filter(fn: (r) => r["_measurement"] == "tail_ipblock")
                  |> filter(fn: (r) => r["_field"] == "action")
                  |> group(columns: ["FeedName"], mode:"by")
                  |> count()
                  |> group()
                  |> limit(n:20, offset: 0)
                  |> drop(columns: ["_start", "_stop"])
                  |> rename(columns: {_value: "count"})
        tableOptions:
            verticalTimeAxis: true
        timeFormat: YYYY-MM-DD HH:mm:ss
        width: 2
        xPos: 6
        yPos: 6
      - colors:
          - hex: '#ffffff'
            name: white
            type: text
        fieldOptions:
          - displayName: destination
            fieldName: destination
            visible: true
          - displayName: count
            fieldName: count
            visible: true
        height: 3
        kind: Table
        name: DNSBL Top Domains
        queries:
          - query: |-
                from(bucket: v.bucket)
                  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)
                  |> filter(fn: (r) => r["_measurement"] == "tail_dnsbl")
                  |> filter(fn: (r) => r["host"] == v.hostname)
                  |> filter(fn: (r) => r["_field"] == "hitormiss")
                  |> group(columns: ["destination"], mode:"by")
                  |> count()
                  |> group()
                  |> limit(n:20, offset: 0)
                  |> drop(columns: ["_start", "_stop"])
                  |> rename(columns: {_value: "count"})
        tableOptions:
            sortBy: count
            verticalTimeAxis: true
        timeFormat: YYYY-MM-DD HH:mm:ss
        width: 2
        xPos: 8
        yPos: 3
      - colors:
          - hex: '#ffffff'
            name: white
            type: text
        decimalPlaces: 0
        fieldOptions:
          - displayName: destination
            fieldName: destination
            visible: true
          - displayName: source
            fieldName: source
            visible: true
          - displayName: count
            fieldName: count
            visible: true
        height: 4
        kind: Table
        name: DNSBL Top Sources
        queries:
          - query: |-
                from(bucket: v.bucket)
                  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)
                  |> filter(fn: (r) => r["_measurement"] == "tail_dnsbl")
                  |> filter(fn: (r) => r["host"] == v.hostname)
                  |> filter(fn: (r) => r["_field"] == "hitormiss")
                  |> group(columns: ["source"], mode:"by")
                  |> count()
                  |> group()
                  |> limit(n:20, offset: 0)
                  |> drop(columns: ["_start", "_stop"])
                  |> rename(columns: {_value: "count"})
        tableOptions:
            sortBy: count
            verticalTimeAxis: true
        timeFormat: YYYY-MM-DD HH:mm:ss
        width: 2
        xPos: 8
        yPos: 6
      - colors:
          - hex: '#00C9FF'
            name: laser
            type: text
        decimalPlaces: 2
        height: 1
        kind: Single_Stat
        name: Uptime
        queries:
          - query: |-
                from(bucket: v.bucket)
                  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)
                  |>filter(fn: (r) => r["host"] == v.hostname)
                  |> filter(fn: (r) => r["_measurement"] == "system")
                  |> filter(fn: (r) => r["_field"] == "uptime_format")
        width: 2
        xPos: 10
      - colors:
          - hex: '#00C9FF'
            name: laser
            type: text
        decimalPlaces: 2
        height: 1
        kind: Single_Stat
        name: Load 1
        queries:
          - query: |-
                from(bucket: v.bucket)
                  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)
                  |> filter(fn: (r) => r["_measurement"] == "system")
                  |> filter(fn: (r) => r["_field"] == "load5")
                  |> filter(fn: (r) => r["host"] == v.hostname)
        width: 2
        xPos: 10
        yPos: 1
      - colors:
          - hex: '#00C9FF'
            name: laser
            type: text
        decimalPlaces: 2
        height: 1
        kind: Single_Stat
        name: Load 15
        queries:
          - query: |-
                from(bucket: v.bucket)
                  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)
                  |> filter(fn: (r) => r["_measurement"] == "system")
                  |> filter(fn: (r) => r["_field"] == "load5")
                  |> filter(fn: (r) => r["host"] == v.hostname)
        width: 2
        xPos: 10
        yPos: 2
      - colors:
          - hex: '#00C9FF'
            name: laser
            type: text
        decimalPlaces: 0
        height: 1
        kind: Single_Stat
        name: CPU Count
        queries:
          - query: |-
                from(bucket: v.bucket)
                  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)
                  |> filter(fn: (r) => r["_measurement"] == "system")
                  |> filter(fn: (r) => r["_field"] == "n_cpus")
                  |> filter(fn: (r) => r["host"] == v.hostname)
        width: 2
        xPos: 10
        yPos: 3
      - colors:
          - hex: '#00C9FF'
            name: laser
            type: text
        decimalPlaces: 2
        height: 1
        kind: Single_Stat
        name: Memory
        queries:
          - query: |-
                from(bucket: v.bucket)
                  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)
                  |> filter(fn: (r) => r["_measurement"] == "mem")
                  |> filter(fn: (r) => r["host"] == v.hostname)
                  |> filter(fn: (r) => r["_field"] == "total")
                  |> map(fn: (r) => ({
                      r with
                      _value: r._value / 1000000000
                    })
                  )
        width: 2
        xPos: 10
        yPos: 4
      - colors:
          - hex: '#00C9FF'
            name: laser
            type: text
        decimalPlaces: 0
        height: 1
        kind: Single_Stat
        name: Number of blocked IPs
        queries:
          - query: |-
                from(bucket: v.bucket)
                  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)
                  |> filter(fn: (r) => r["host"] == v.hostname)
                  |> filter(fn: (r) => r["_measurement"] == "tail_ipblock")
                  |> filter(fn: (r) => r["_field"] == "action")
                  |> keep(columns: ["_value"])
                  |> map(fn: (r) => ({new_column: r._value, _value:r._value}))
                  |> group(columns: ["new_column"])
                  |>count()
        width: 2
        xPos: 10
        yPos: 5
      - colors:
          - hex: '#00C9FF'
            name: laser
            type: text
        decimalPlaces: 0
        height: 1
        kind: Single_Stat
        name: Number of DNS Blocks
        queries:
          - query: |-
                from(bucket: v.bucket)
                  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)
                  |> filter(fn: (r) => r["host"] == v.hostname)
                  |> filter(fn: (r) => r["_measurement"] == "tail_dnsbl")
                  |> filter(fn: (r) => r["_field"] == "hitormiss")
                  |> keep(columns: ["_value"])
                  |> map(fn: (r) => ({new_column: r._value, _value:r._value}))
                  |> group(columns: ["new_column"])
                  |> group()
                  |> count()
        width: 2
        xPos: 10
        yPos: 6
      - colors:
          - hex: '#00C9FF'
            name: laser
            type: text
        decimalPlaces: 0
        height: 1
        kind: Single_Stat
        name: Number of IPS Alerts
        queries:
          - query: |-
                from(bucket: v.bucket)
                  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)
                  |> filter(fn: (r) => r["host"] == v.hostname)
                  |> filter(fn: (r) => r["_measurement"] == "tail_snort_alerts")
                  |> filter(fn: (r) => r["_field"] == "idk")
                  |> keep(columns: ["_value"])
                  |> count()
        width: 2
        xPos: 10
        yPos: 7
      - axes:
          - base: "10"
            name: x
            scale: linear
          - base: "10"
            name: y
            scale: linear
        colors:
          - hex: '#00C9FF'
            name: laser
            type: text
        decimalPlaces: 2
        height: 2
        kind: Single_Stat_Plus_Line
        name: Disk usage
        position: overlaid
        queries:
          - query: |-
                from(bucket: v.bucket)
                  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)
                  |> filter(fn: (r) => r["_measurement"] == "disk")
                  |> filter(fn: (r) => r["_field"] == "used_percent")
                  |> filter(fn: (r) => r["host"] == v.hostname)
        width: 2
        xCol: _time
        xPos: 10
        yCol: _value
        yPos: 8
    name: Pfsense Metrics
---
apiVersion: influxdata.com/v2alpha1
kind: Dashboard
metadata:
    name: righteous-mayer-cfc001
spec:
    associations:
      - kind: Label
        name: terrifying-tu-cfc001
    charts:
      - axes:
          - base: "10"
            name: x
            scale: linear
          - base: "10"
            name: y
            scale: linear
        colors:
          - hex: '#00C9FF'
            name: laser
            type: text
        decimalPlaces: 2
        height: 3
        kind: Single_Stat_Plus_Line
        name: CPU usage
        position: overlaid
        queries:
          - query: "import \"math\"\nfrom(bucket: \"linux\")\n  |> range(start: v.timeRangeStart,
                stop: v.timeRangeStop)\n  |> filter(fn: (r) => r[\"_measurement\"]
                == \"cpu\")\n  |> filter(fn: (r) => r[\"host\"] == v.hostname)\n  |>
                filter(fn: (r) => r[\"cpu\"] == \"cpu-total\")\n  |> filter(fn: (r)
                => r[\"_field\"] == \"usage_idle\")\n  |> map(fn: (r) => ({\n      r
                with \n      _value: 100.0 - r._value\n      })\n  )"
        width: 5
      - axes:
          - base: "10"
            name: x
            scale: linear
          - base: "10"
            name: y
            scale: linear
        colors:
          - hex: '#00C9FF'
            name: laser
            type: text
        decimalPlaces: 2
        height: 5
        kind: Single_Stat_Plus_Line
        name: Outbound Traffic
        position: overlaid
        queries:
          - query: |-
                from(bucket: v.bucket)
                  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)
                  |> filter(fn: (r) => r["_measurement"] == "net")
                  |> filter(fn: (r) => r["_field"] == "bytes_sent")
                  |> filter(fn: (r) => r["host"] == v.hostname)
                  |> filter(fn: (r) => r["interface"] == v.interface)
                  |> map(fn: (r) => ({
                      r with
                      _value: r._value / 125
                    })
                  )
                  |> derivative(unit: 1s, nonNegative: false)
                  |> yield(name: "derivative")
                  |> last()
        width: 3
        xCol: _time
        yCol: _value
        yPos: 3
      - colors:
          - hex: '#ffffff'
            name: white
            type: text
        fieldOptions:
          - displayName: _start
            fieldName: _start
            visible: true
          - displayName: _stop
            fieldName: _stop
            visible: true
          - displayName: _time
            fieldName: _time
            visible: true
          - displayName: _value
            fieldName: _value
            visible: true
          - displayName: _field
            fieldName: _field
            visible: true
          - displayName: _measurement
            fieldName: _measurement
            visible: true
          - displayName: active
            fieldName: active
            visible: true
          - displayName: host
            fieldName: host
            visible: true
          - displayName: load
            fieldName: load
            visible: true
          - displayName: name
            fieldName: name
            visible: true
          - displayName: sub
            fieldName: sub
            visible: true
        height: 4
        kind: Table
        name: Failed Services
        queries:
          - query: |-
                from(bucket: v.bucket)
                  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)
                  |> filter(fn: (r) => r["_measurement"] == "systemd_units")
                  |> filter(fn: (r) => r["host"] == v.hostname)
                  |> filter(fn: (r) => r["active"] == "failed")
                  |> filter(fn: (r) => r["_field"] == "active_code")
                  |> first()
                  |> group()
                  |> keep(columns: ["name"])
        tableOptions:
            verticalTimeAxis: true
        timeFormat: YYYY-MM-DD HH:mm:ss
        width: 3
        yPos: 8
      - axes:
          - base: "10"
            name: x
            scale: linear
          - base: "10"
            name: y
            scale: linear
        colors:
          - hex: '#00C9FF'
            name: laser
            type: text
        decimalPlaces: 2
        height: 5
        kind: Single_Stat_Plus_Line
        name: Inbound traffic
        position: overlaid
        queries:
          - query: |-
                from(bucket: v.bucket)
                  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)
                  |> filter(fn: (r) => r["_measurement"] == "net")
                  |> filter(fn: (r) => r["_field"] == "bytes_sent")
                  |> filter(fn: (r) => r["host"] == v.hostname)
                  |> filter(fn: (r) => r["interface"] == v.interface)
                  |> map(fn: (r) => ({
                      r with
                      _value: r._value / 125
                    })
                  )
                  |> derivative(unit: 1s, nonNegative: false)
                  |> yield(name: "derivative")
                  |> last()
        width: 3
        xCol: _time
        xPos: 3
        yCol: _value
        yPos: 3
      - colors:
          - hex: '#ffffff'
            name: white
            type: text
        fieldOptions:
          - displayName: name
            fieldName: name
            visible: true
          - displayName: _start
            fieldName: _start
            visible: true
          - displayName: _stop
            fieldName: _stop
            visible: true
          - displayName: _time
            fieldName: _time
            visible: true
          - displayName: _value
            fieldName: _value
            visible: true
          - displayName: _field
            fieldName: _field
            visible: true
          - displayName: _measurement
            fieldName: _measurement
            visible: true
          - displayName: active
            fieldName: active
            visible: true
          - displayName: host
            fieldName: host
            visible: true
          - displayName: load
            fieldName: load
            visible: true
          - displayName: sub
            fieldName: sub
            visible: true
        height: 4
        kind: Table
        name: Services
        queries:
          - query: |-
                from(bucket: v.bucket)
                  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)
                  |> filter(fn: (r) => r["_measurement"] == "systemd_units")
                  |> filter(fn: (r) => r["host"] == v.hostname)
                  |> filter(fn: (r) => r["_field"] == "active_code")
                  |> first()
                  |> group()
                  |> keep(columns: ["name","active","sub"])
        tableOptions:
            sortBy: name
            verticalTimeAxis: true
        timeFormat: YYYY-MM-DD HH:mm:ss
        width: 7
        xPos: 3
        yPos: 8
      - axes:
          - base: "10"
            name: x
            scale: linear
          - base: "10"
            name: y
            scale: linear
        colors:
          - hex: '#00C9FF'
            name: laser
            type: text
        decimalPlaces: 2
        height: 3
        kind: Single_Stat_Plus_Line
        name: Ram usage
        position: overlaid
        queries:
          - query: |-
                from(bucket: "linux")
                  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)
                  |> filter(fn: (r) => r["_measurement"] == "mem")
                  |> filter(fn: (r) => r["_field"] == "used_percent")
                  |> filter(fn: (r) => r["host"] == v.hostname)
        width: 5
        xCol: _time
        xPos: 5
        yCol: _value
      - axes:
          - base: "10"
            name: x
            scale: linear
          - base: "10"
            name: y
            scale: linear
        colors:
          - hex: '#00C9FF'
            name: laser
            type: text
        decimalPlaces: 2
        height: 5
        kind: Single_Stat_Plus_Line
        name: Disk usage
        position: overlaid
        queries:
          - query: |-
                from(bucket: v.bucket)
                  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)
                  |> filter(fn: (r) => r["_measurement"] == "disk")
                  |> filter(fn: (r) => r["_field"] == "used_percent")
                  |> filter(fn: (r) => r["host"] == v.hostname)
        width: 4
        xCol: _time
        xPos: 6
        yCol: _value
        yPos: 3
      - colors:
          - hex: '#ffffff'
            name: white
            type: text
        fieldOptions:
          - displayName: _field
            fieldName: _field
            visible: true
          - displayName: _measurement
            fieldName: _measurement
            visible: true
          - displayName: _start
            fieldName: _start
            visible: true
          - displayName: _stop
            fieldName: _stop
            visible: true
          - displayName: _time
            fieldName: _time
            visible: true
          - displayName: URL
            fieldName: _value
            visible: true
          - displayName: host
            fieldName: host
            visible: true
        height: 1
        kind: Table
        name: Remote Access
        queries:
          - query: |-
                import "strings"
                from(bucket: v.bucket)
                  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)
                  |> filter(fn: (r) => r["_measurement"] == "exec_meshinfo")
                  |> filter(fn: (r) => r["_field"] == "value")
                  |> filter(fn: (r) => r["host"] == v.hostname)
                  |> last()
                  |> keep(columns: ["_value"])
                  |> map(fn: (r) => ({ r with _value: strings.joinStr(arr: ["https://",v.mesh_info, "/?viewmode=11&gotonode=",r._value], v: "")}))
        tableOptions:
            verticalTimeAxis: true
        timeFormat: YYYY-MM-DD HH:mm:ss
        width: 2
        xPos: 10
      - colors:
          - hex: '#00C9FF'
            name: laser
            type: text
        decimalPlaces: 2
        height: 1
        kind: Single_Stat
        name: Uptime
        queries:
          - query: |-
                from(bucket: v.bucket)
                  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)
                  |>filter(fn: (r) => r["host"] == v.hostname)
                  |> filter(fn: (r) => r["_measurement"] == "system")
                  |> filter(fn: (r) => r["_field"] == "uptime_format")
        width: 2
        xPos: 10
        yPos: 1
      - colors:
          - hex: '#00C9FF'
            name: laser
            type: text
        decimalPlaces: 2
        height: 1
        kind: Single_Stat
        name: Load 1
        queries:
          - query: |-
                from(bucket: v.bucket)
                  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)
                  |> filter(fn: (r) => r["_measurement"] == "system")
                  |> filter(fn: (r) => r["_field"] == "load5")
                  |> filter(fn: (r) => r["host"] == v.hostname)
        width: 2
        xPos: 10
        yPos: 2
      - colors:
          - hex: '#00C9FF'
            name: laser
            type: text
        decimalPlaces: 2
        height: 1
        kind: Single_Stat
        name: Load 15
        queries:
          - query: |-
                from(bucket: v.bucket)
                  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)
                  |> filter(fn: (r) => r["_measurement"] == "system")
                  |> filter(fn: (r) => r["_field"] == "load5")
                  |> filter(fn: (r) => r["host"] == v.hostname)
        width: 2
        xPos: 10
        yPos: 3
      - colors:
          - hex: '#00C9FF'
            name: laser
            type: text
        decimalPlaces: 0
        height: 1
        kind: Single_Stat
        name: CPU Count
        queries:
          - query: |-
                from(bucket: v.bucket)
                  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)
                  |> filter(fn: (r) => r["_measurement"] == "system")
                  |> filter(fn: (r) => r["_field"] == "n_cpus")
                  |> filter(fn: (r) => r["host"] == v.hostname)
        width: 2
        xPos: 10
        yPos: 4
      - colors:
          - hex: '#00C9FF'
            name: laser
            type: text
        decimalPlaces: 2
        height: 1
        kind: Single_Stat
        name: Memory
        queries:
          - query: |-
                from(bucket: v.bucket)
                  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)
                  |> filter(fn: (r) => r["_measurement"] == "mem")
                  |> filter(fn: (r) => r["host"] == v.hostname)
                  |> filter(fn: (r) => r["_field"] == "total")
                  |> map(fn: (r) => ({
                      r with
                      _value: r._value / 1000000000
                    })
                  )
        width: 2
        xPos: 10
        yPos: 5
      - colors:
          - hex: '#00C9FF'
            name: laser
            type: text
        decimalPlaces: 2
        height: 1
        kind: Single_Stat
        name: OS
        queries:
          - query: |-
                from(bucket: v.bucket)
                  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)
                  |> filter(fn: (r) => r["host"] == v.hostname)
                  |> filter(fn: (r) => r["_measurement"] == "exec_os_release")
                  |> filter(fn: (r) => r["_field"] == "NAME")
        width: 2
        xPos: 10
        yPos: 6
      - colors:
          - hex: '#00C9FF'
            name: laser
            type: text
        decimalPlaces: 2
        height: 1
        kind: Single_Stat
        name: OS version
        queries:
          - query: |-
                from(bucket: v.bucket)
                  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)
                  |> filter(fn: (r) => r["host"] == v.hostname)
                  |> filter(fn: (r) => r["_measurement"] == "exec_os_release")
                  |> filter(fn: (r) => r["_field"] == "VERSION")
        width: 2
        xPos: 10
        yPos: 7
    name: Linux Metrics
---
apiVersion: influxdata.com/v2alpha1
kind: Dashboard
metadata:
    name: serene-khayyam-8fc001
spec:
    associations:
      - kind: Label
        name: terrifying-tu-cfc001
    charts:
      - axes:
          - base: "10"
            name: x
            scale: linear
          - base: "10"
            name: y
            scale: linear
        colors:
          - hex: '#00C9FF'
            name: laser
            type: text
        decimalPlaces: 2
        height: 4
        kind: Single_Stat_Plus_Line
        name: Ram usage per node
        position: overlaid
        queries:
          - query: |-
                from(bucket: v.bucket)
                  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)
                  |> filter(fn: (r) => r["_measurement"] == "memory")
                  |> filter(fn: (r) => r["_field"] == "memused" or r["_field"] == "memtotal")
                  |> filter(fn: (r) => r["host"] == v.pve_node)
                  |> pivot(rowKey:["_time"], columnKey: ["_field"], valueColumn: "_value")
                  |> map(fn: (r) => ({ r with _value: r.memused / r.memtotal * 100.0}))
        width: 5
        xCol: _time
        yCol: _value
      - colors:
          - hex: '#ffffff'
            name: white
            type: text
        decimalPlaces: 2
        fieldOptions:
          - displayName: _start
            fieldName: _start
            visible: true
          - displayName: _stop
            fieldName: _stop
            visible: true
          - displayName: _time
            fieldName: _time
            visible: true
          - displayName: _value
            fieldName: _value
            visible: true
          - displayName: _field
            fieldName: _field
            visible: true
          - displayName: _measurement
            fieldName: _measurement
            visible: true
          - displayName: host
            fieldName: host
            visible: true
          - displayName: nodename
            fieldName: nodename
            visible: true
          - displayName: object
            fieldName: object
            visible: true
          - displayName: vmid
            fieldName: vmid
            visible: true
          - displayName: cpus
            fieldName: cpus
            visible: true
          - displayName: maxmem
            fieldName: maxmem
            visible: true
          - displayName: mem
            fieldName: mem
            visible: true
          - displayName: percentmem
            fieldName: percentmem
            visible: true
          - displayName: cpu
            fieldName: cpu
            visible: true
          - displayName: qmpstatus
            fieldName: qmpstatus
            visible: true
        height: 4
        kind: Table
        name: Containers
        queries:
          - query: |-
                import "math"
                from(bucket: v.bucket)
                  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)
                  |> filter(fn: (r) => r["nodename"] == v.pve_node)
                  |> filter(fn: (r) => r["object"] == "lxc" or r["object"] == "qemu")
                  |> filter(fn: (r) => r["_field"] == "cpus" or r["_field"] == "maxmem" or r["_field"] == "mem" or r["_field"] == "cpu" or r["_field"] == "qmpstatus")
                  |> pivot(rowKey:["_time"], columnKey: ["_field"], valueColumn: "_value")
                  |> map(fn: (r) => ({ r with maxmem: r.maxmem / 1073742000.0}))
                  |> map(fn: (r) => ({ r with mem: r.mem / 1073742000.0}))
                  |> map(fn: (r) => ({ r with percentmem: r.mem / r.maxmem * 100.0}))
                  |> map(fn: (r) => ({ r with cpu: r.cpu * 100.0}))
                  |> sort(columns: ["_time"], desc: true)
                  |> limit(n:1, offset: 0)
                  |> group()
                  |> keep(columns: ["host","vmid","object","cpus","cpu","mem","maxmem","percentmem"])
        tableOptions:
            verticalTimeAxis: true
        timeFormat: YYYY-MM-DD HH:mm:ss
        width: 10
        yPos: 4
      - axes:
          - base: "10"
            name: x
            scale: linear
          - base: "10"
            name: y
            scale: linear
        colors:
          - hex: '#00C9FF'
            name: laser
            type: text
        decimalPlaces: 2
        height: 4
        kind: Single_Stat_Plus_Line
        name: CPU
        position: overlaid
        queries:
          - query: |-
                from(bucket: v.bucket)
                  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)
                  |> filter(fn: (r) => r["_measurement"] == "cpustat")
                  |> filter(fn: (r) => r["_field"] == "cpu" or r["_field"] == "cpus")
                  |> filter(fn: (r) => r["host"] == v.pve_node)
                  |> pivot(rowKey:["_time"], columnKey: ["_field"], valueColumn: "_value")
                  |> map(fn: (r) => ({ r with _value: r.cpu * 100.0}))
        width: 5
        xCol: _time
        xPos: 5
        yCol: _value
      - colors:
          - hex: '#00C9FF'
            name: laser
            type: text
        decimalPlaces: 2
        height: 1
        kind: Single_Stat
        name: Load1
        queries:
          - query: |-
                from(bucket: v.bucket)
                  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)
                  |> filter(fn: (r) => r["_measurement"] == "cpustat")
                  |> filter(fn: (r) => r["_field"] == "avg1")
                  |> filter(fn: (r) => r["host"] == v.pve_node)
        width: 2
        xPos: 10
      - colors:
          - hex: '#00C9FF'
            name: laser
            type: text
        decimalPlaces: 2
        height: 1
        kind: Single_Stat
        name: Load 15
        queries:
          - query: |-
                from(bucket: v.bucket)
                  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)
                  |> filter(fn: (r) => r["_measurement"] == "cpustat")
                  |> filter(fn: (r) => r["_field"] == "avg15")
                  |> filter(fn: (r) => r["host"] == v.pve_node)
        width: 2
        xPos: 10
        yPos: 1
      - axes:
          - base: "10"
            name: x
            scale: linear
          - base: "10"
            name: y
            scale: linear
        colors:
          - hex: '#00C9FF'
            name: laser
            type: text
        decimalPlaces: 2
        height: 2
        kind: Single_Stat_Plus_Line
        name: IO Wait
        position: overlaid
        queries:
          - query: |-
                from(bucket: v.bucket)
                  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)
                  |> filter(fn: (r) => r["_measurement"] == "cpustat")
                  |> filter(fn: (r) => r["host"] == v.pve_node)
                  |> filter(fn: (r) => r["_field"] == "wait")
                  |> map(fn: (r) => ({ r with _value: r._value * 100.0}))
        width: 2
        xCol: _time
        xPos: 10
        yCol: _value
        yPos: 2
      - colors:
          - hex: '#ffffff'
            name: white
            type: text
        decimalPlaces: 0
        fieldOptions:
          - displayName: _measurement
            fieldName: _measurement
            visible: true
          - displayName: _start
            fieldName: _start
            visible: true
          - displayName: _stop
            fieldName: _stop
            visible: true
          - displayName: _time
            fieldName: _time
            visible: true
          - displayName: _value
            fieldName: _value
            visible: true
          - displayName: host
            fieldName: host
            visible: true
          - displayName: nodename
            fieldName: nodename
            visible: true
          - displayName: object
            fieldName: object
            visible: true
          - displayName: total
            fieldName: total
            visible: true
          - displayName: type
            fieldName: type
            visible: true
          - displayName: used
            fieldName: used
            visible: true
          - displayName: percent
            fieldName: percent
            visible: true
          - displayName: pool
            fieldName: pool
            visible: true
        height: 4
        kind: Table
        name: Storage
        queries:
          - query: |-
                from(bucket: v.bucket)
                  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)
                  |> filter(fn: (r) => r["nodename"] == v.pve_node)
                  |> filter(fn: (r) => r["_measurement"] == "system")
                  |> filter(fn: (r) => r["_field"] == "used" or r["_field"] == "total")
                  |> filter(fn: (r) => r["object"] == "storages")
                  |> pivot(rowKey:["_time"], columnKey: ["_field"], valueColumn: "_value")
                  |> map(fn: (r) => ({ r with _value: r.used / r.total * 100.0}))
                  |> map(fn: (r) => ({ r with used: r.used / (1.00737*10.0^9.0)}))
                  |> map(fn: (r) => ({ r with total: r.total / (1.00737*10.0^9.0)}))
                  |> last()
                  |> group()
                  |> rename(columns: {host: "pool", _value: "percent"})
                  |> keep(columns: ["used","total","percent","pool"])
        tableOptions:
            verticalTimeAxis: true
        timeFormat: YYYY-MM-DD HH:mm:ss
        width: 2
        xPos: 10
        yPos: 4
    name: Proxmox Metrics
---
apiVersion: influxdata.com/v2alpha1
kind: Dashboard
metadata:
    name: silly-williams-cfc001
spec:
    associations:
      - kind: Label
        name: terrifying-tu-cfc001
    charts:
      - colors:
          - hex: '#ffffff'
            name: white
            type: text
        fieldOptions:
          - displayName: _start
            fieldName: _start
            visible: true
          - displayName: _stop
            fieldName: _stop
            visible: true
          - displayName: _field
            fieldName: _field
            visible: true
          - displayName: _measurement
            fieldName: _measurement
            visible: true
          - displayName: common_name
            fieldName: common_name
            visible: true
          - displayName: country
            fieldName: country
            visible: true
          - displayName: host
            fieldName: host
            visible: true
          - displayName: issuer_common_name
            fieldName: issuer_common_name
            visible: true
          - displayName: organization
            fieldName: organization
            visible: true
          - displayName: public_key_algorithm
            fieldName: public_key_algorithm
            visible: true
          - displayName: serial_number
            fieldName: serial_number
            visible: true
          - displayName: signature_algorithm
            fieldName: signature_algorithm
            visible: true
          - displayName: source
            fieldName: source
            visible: true
          - displayName: verification
            fieldName: verification
            visible: true
          - displayName: _value
            fieldName: _value
            visible: true
          - displayName: _time
            fieldName: _time
            visible: true
          - displayName: san
            fieldName: san
            visible: true
          - displayName: enddate
            fieldName: enddate
            visible: true
          - displayName: verification_code
            fieldName: verification_code
            visible: true
          - displayName: expire_time
            fieldName: expire_time
            visible: true
          - displayName: cur_time
            fieldName: cur_time
            visible: true
          - displayName: exipre_dur
            fieldName: exipre_dur
            visible: true
          - displayName: expire_dur
            fieldName: expire_dur
            visible: true
          - displayName: exire_dur
            fieldName: exire_dur
            visible: true
          - displayName: current_time
            fieldName: current_time
            visible: true
          - displayName: Expire Date
            fieldName: Expire Date
            visible: true
          - displayName: Time Till Expiration
            fieldName: Time Till Expiration
            visible: true
          - displayName: Certifcate Authority
            fieldName: Certifcate Authority
            visible: true
        height: 4
        kind: Table
        name: Invalid SSL Checks
        queries:
          - query: "from(bucket: \"linux\")\n  |> range(start: v.timeRangeStart, stop:
                v.timeRangeStop)\n  |> filter(fn: (r) => r[\"_measurement\"] == \"x509_cert\")\n
                \ |> filter(fn: (r) => r[\"_field\"] == \"verification_code\" or r[\"_field\"]
                == \"enddate\") \n  |> filter(fn: (r) => r[\"verification\"] == \"invalid\")\n
                \ |> pivot(rowKey:[\"_time\"], columnKey: [\"_field\"], valueColumn:
                \"_value\")\n  |> group(columns: [\"common_name\"], mode: \"by\")\n
                \ //|> drop(columns: [\"_start\",\"_stop\",\"country\",\"host\",\"serial_number\",\"_time\",\"_measurement\",\"verification_code\",\"public_key_algorithm\"])\n
                \ |> map(fn:(r) => ({ r with enddate: int(v: r.enddate) * 1000000000}))\n
                \ |> map(fn: (r) => ({ r with expire_dur: r.enddate - int(v: uint(v:
                now())) }))\n  |> map(fn:(r) => ({ r with expire_time: string(v: duration(v:
                r.expire_dur)) }))\n  |> map(fn:(r) => ({ r with _value: time(v: (r.enddate))
                }))\n  |> last()\n  |> group()\n  |> keep(columns: [\"common_name\",\"issuer_common_name\",\"_value\",\"expire_time\",\"source\"])\n
                \ |> rename(columns: {issuer_common_name: \"Certifcate Authority\",
                _value: \"Expire Date\", expire_time: \"Time Till Expiration\"})"
        tableOptions:
            verticalTimeAxis: true
        timeFormat: YYYY-MM-DD HH:mm:ss
        width: 8
      - colors:
          - hex: '#ffffff'
            name: white
            type: text
        fieldOptions:
          - displayName: _start
            fieldName: _start
            visible: true
          - displayName: _stop
            fieldName: _stop
            visible: true
          - displayName: _time
            fieldName: _time
            visible: true
          - displayName: _value
            fieldName: _value
            visible: true
          - displayName: _field
            fieldName: _field
            visible: true
          - displayName: _measurement
            fieldName: _measurement
            visible: true
          - displayName: host
            fieldName: host
            visible: true
          - displayName: method
            fieldName: method
            visible: true
          - displayName: server
            fieldName: server
            visible: true
          - displayName: status_code
            fieldName: status_code
            visible: true
          - displayName: content_length
            fieldName: content_length
            visible: true
          - displayName: http_response_code
            fieldName: http_response_code
            visible: true
          - displayName: response_time
            fieldName: response_time
            visible: true
          - displayName: result_code
            fieldName: result_code
            visible: true
          - displayName: result_type
            fieldName: result_type
            visible: true
        height: 3
        kind: Table
        name: Successful HTTP Checks
        queries:
          - query: |-
                from(bucket: "linux")
                  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)
                  |> filter(fn: (r) => r["_measurement"] == "http_response")
                  |> filter(fn: (r) => r["result"] == "success")
                  |> pivot(rowKey:["_time"], columnKey: ["_field"], valueColumn: "_value")
                  |> map(fn: (r) => ({ r with _value: r.method }))
                  |> last()
                  |> group()
                  |> keep(columns: ["server", "status_code","response_time","result_code"])
        tableOptions:
            verticalTimeAxis: true
        timeFormat: YYYY-MM-DD HH:mm:ss
        width: 12
        yPos: 4
      - colors:
          - hex: '#ffffff'
            name: white
            type: text
        fieldOptions:
          - displayName: _start
            fieldName: _start
            visible: true
          - displayName: _stop
            fieldName: _stop
            visible: true
          - displayName: _field
            fieldName: _field
            visible: true
          - displayName: _measurement
            fieldName: _measurement
            visible: true
          - displayName: common_name
            fieldName: common_name
            visible: true
          - displayName: country
            fieldName: country
            visible: true
          - displayName: host
            fieldName: host
            visible: true
          - displayName: issuer_common_name
            fieldName: issuer_common_name
            visible: true
          - displayName: organization
            fieldName: organization
            visible: true
          - displayName: public_key_algorithm
            fieldName: public_key_algorithm
            visible: true
          - displayName: serial_number
            fieldName: serial_number
            visible: true
          - displayName: signature_algorithm
            fieldName: signature_algorithm
            visible: true
          - displayName: source
            fieldName: source
            visible: true
          - displayName: verification
            fieldName: verification
            visible: true
          - displayName: _value
            fieldName: _value
            visible: true
          - displayName: _time
            fieldName: _time
            visible: true
          - displayName: san
            fieldName: san
            visible: true
          - displayName: enddate
            fieldName: enddate
            visible: true
          - displayName: verification_code
            fieldName: verification_code
            visible: true
          - displayName: expire_time
            fieldName: expire_time
            visible: true
          - displayName: cur_time
            fieldName: cur_time
            visible: true
          - displayName: exipre_dur
            fieldName: exipre_dur
            visible: true
          - displayName: expire_dur
            fieldName: expire_dur
            visible: true
          - displayName: exire_dur
            fieldName: exire_dur
            visible: true
          - displayName: current_time
            fieldName: current_time
            visible: true
          - displayName: Expire Date
            fieldName: Expire Date
            visible: true
          - displayName: Time Till Expiration
            fieldName: Time Till Expiration
            visible: true
          - displayName: Certifcate Authority
            fieldName: Certifcate Authority
            visible: true
        height: 4
        kind: Table
        name: ALL SSL Checks
        queries:
          - query: "from(bucket: \"linux\")\n  |> range(start: v.timeRangeStart, stop:
                v.timeRangeStop)\n  |> filter(fn: (r) => r[\"_measurement\"] == \"x509_cert\")\n
                \ |> filter(fn: (r) => r[\"_field\"] == \"verification_code\" or r[\"_field\"]
                == \"enddate\") \n  |> pivot(rowKey:[\"_time\"], columnKey: [\"_field\"],
                valueColumn: \"_value\")\n  |> group(columns: [\"common_name\"], mode:
                \"by\")\n  //|> drop(columns: [\"_start\",\"_stop\",\"country\",\"host\",\"serial_number\",\"_time\",\"_measurement\",\"verification_code\",\"public_key_algorithm\"])\n
                \ |> map(fn:(r) => ({ r with enddate: int(v: r.enddate) * 1000000000}))\n
                \ |> map(fn: (r) => ({ r with expire_dur: r.enddate - int(v: uint(v:
                now())) }))\n  |> map(fn:(r) => ({ r with expire_time: string(v: duration(v:
                r.expire_dur)) }))\n  |> map(fn:(r) => ({ r with _value: time(v: (r.enddate))
                }))\n  |> last()\n  |> group()\n  |> keep(columns: [\"common_name\",\"issuer_common_name\",\"_value\",\"expire_time\",\"source\",\"verification\"])\n
                \ |> rename(columns: {issuer_common_name: \"Certifcate Authority\",
                _value: \"Expire Date\", expire_time: \"Time Till Expiration\"})"
        tableOptions:
            verticalTimeAxis: true
        timeFormat: YYYY-MM-DD HH:mm:ss
        width: 12
        yPos: 7
      - colors:
          - hex: '#ffffff'
            name: white
            type: text
        fieldOptions:
          - displayName: _start
            fieldName: _start
            visible: true
          - displayName: _stop
            fieldName: _stop
            visible: true
          - displayName: _field
            fieldName: _field
            visible: true
          - displayName: _measurement
            fieldName: _measurement
            visible: true
          - displayName: host
            fieldName: host
            visible: true
          - displayName: method
            fieldName: method
            visible: true
          - displayName: server
            fieldName: server
            visible: true
          - displayName: status_code
            fieldName: status_code
            visible: true
          - displayName: _value
            fieldName: _value
            visible: true
          - displayName: _time
            fieldName: _time
            visible: true
        height: 4
        kind: Table
        name: Failed HTTP Checks
        queries:
          - query: |-
                from(bucket: "linux")
                  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)
                  |> filter(fn: (r) => r["_measurement"] == "http_response")
                  |> filter(fn: (r) => r["_field"] == "result_type")
                  |> filter(fn: (r) => r["result"] != "success")
                  |> last()
                  |> group()
                  |> keep(columns: ["server",,"result"])
        tableOptions:
            verticalTimeAxis: true
        timeFormat: YYYY-MM-DD HH:mm:ss
        width: 4
        xPos: 8
    name: Web Stuff
---
apiVersion: influxdata.com/v2alpha1
kind: Dashboard
metadata:
    name: trusting-aryabhata-0fc001
spec:
    associations:
      - kind: Label
        name: terrifying-tu-cfc001
    charts:
      - axes:
          - base: "10"
            name: x
            scale: linear
          - base: "10"
            name: y
            scale: linear
        colors:
          - hex: '#00C9FF'
            name: laser
            type: text
        decimalPlaces: 2
        height: 3
        kind: Single_Stat_Plus_Line
        name: CPU usage
        position: overlaid
        queries:
          - query: "import \"math\"\nfrom(bucket: v.bucket)\n  |> range(start: v.timeRangeStart,
                stop: v.timeRangeStop)\n  |> filter(fn: (r) => r[\"_measurement\"]
                == \"cpu\")\n  |> filter(fn: (r) => r[\"host\"] == v.hostname)\n  |>
                filter(fn: (r) => r[\"cpu\"] == \"cpu-total\")\n  |> filter(fn: (r)
                => r[\"_field\"] == \"usage_idle\")\n  |> map(fn: (r) => ({\n      r
                with \n      _value: 100.0 - r._value\n      })\n  )"
        width: 5
        xCol: _time
        yCol: _value
      - axes:
          - base: "10"
            name: x
            scale: linear
          - base: "10"
            name: y
            scale: linear
        colors:
          - hex: '#00C9FF'
            name: laser
            type: text
        decimalPlaces: 2
        height: 5
        kind: Single_Stat_Plus_Line
        name: Outbound Traffic
        position: overlaid
        queries:
          - query: |-
                from(bucket: v.bucket)
                  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)
                  |> filter(fn: (r) => r["_measurement"] == "net")
                  |> filter(fn: (r) => r["_field"] == "bytes_sent")
                  |> filter(fn: (r) => r["host"] == v.hostname)
                  |> filter(fn: (r) => r["interface"] == v.interface)
                  |> map(fn: (r) => ({
                      r with
                      _value: r._value / 125
                    })
                  )
                  |> derivative(unit: 1s, nonNegative: false)
                  |> yield(name: "derivative")
                  |> last()
        width: 3
        xCol: _time
        yCol: _value
        yPos: 3
      - colors:
          - hex: '#ffffff'
            name: white
            type: text
        fieldOptions:
          - displayName: _start
            fieldName: _start
            visible: true
          - displayName: _stop
            fieldName: _stop
            visible: true
          - displayName: _time
            fieldName: _time
            visible: true
          - displayName: _value
            fieldName: _value
            visible: true
          - displayName: _field
            fieldName: _field
            visible: true
          - displayName: _measurement
            fieldName: _measurement
            visible: true
          - displayName: display_name
            fieldName: display_name
            visible: true
          - displayName: host
            fieldName: host
            visible: true
          - displayName: service_name
            fieldName: service_name
            visible: true
          - displayName: status
            fieldName: status
            visible: true
          - displayName: startup_mode
            fieldName: startup_mode
            visible: true
          - displayName: state
            fieldName: state
            visible: true
          - displayName: startup
            fieldName: startup
            visible: true
          - displayName: starup_mode
            fieldName: starup_mode
            visible: true
        height: 4
        kind: Table
        name: Services
        queries:
          - query: "from(bucket: v.bucket)\n  |> range(start: v.timeRangeStart, stop:
                v.timeRangeStop)\n  |> filter(fn: (r) => r[\"_measurement\"] == \"win_services\")\n
                \ |> filter(fn: (r) => r[\"_field\"] == \"state\" or r[\"_field\"]
                == \"starup_mode_mode\")\n  |> filter(fn: (r) => r[\"host\"] == v.hostname)
                \n  |> first()\n  |> group()\n    |> pivot(rowKey:[\"service_name\"],
                columnKey: [\"_field\"], valueColumn: \"_value\")\n  |> map(fn: (r)
                => ({ r with state: \n    if r.state == 1 then \"stopped\" \n    else
                if r.state == 2 then \"starting\"\n    else if r.state == 3 then \"stopping\"\n
                \   else if r.state == 4 then \"running\"\n    else if r.state ==
                5 then \"continuing\"\n    else if r.state == 6 then \"pausing\"\n
                \   else if r.state == 7 then \"paused\"\n    else \"unkown\" }))\n
                \ |> map(fn: (r) => ({ r with starup_mode: \n    if r.starup_mode
                == 0 then \"boot start\" \n    else if r.starup_mode == 1 then \"system
                start\"\n    else if r.starup_mode == 2 then \"auto start\"\n    else
                if r.starup_mode == 3 then \"manual\"\n    else if r.starup_mode ==
                4 then \"disabled\"\n    else \"unkown\" }))"
        tableOptions:
            verticalTimeAxis: true
        timeFormat: YYYY-MM-DD HH:mm:ss
        width: 7
        yPos: 8
      - axes:
          - base: "10"
            name: x
            scale: linear
          - base: "10"
            name: y
            scale: linear
        colors:
          - hex: '#00C9FF'
            name: laser
            type: text
        decimalPlaces: 2
        height: 5
        kind: Single_Stat_Plus_Line
        name: Inbound traffic
        position: overlaid
        queries:
          - query: |-
                from(bucket: v.bucket)
                  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)
                  |> filter(fn: (r) => r["_measurement"] == "net")
                  |> filter(fn: (r) => r["_field"] == "bytes_recv")
                  |> filter(fn: (r) => r["host"] == v.hostname)
                  |> filter(fn: (r) => r["interface"] == v.interface)
                  |> map(fn: (r) => ({
                      r with
                      _value: r._value / 125
                    })
                  )
                  |> derivative(unit: 1s, nonNegative: false)
                  |> yield(name: "derivative")
                  |> last()
        width: 3
        xCol: _time
        xPos: 3
        yCol: _value
        yPos: 3
      - axes:
          - base: "10"
            name: x
            scale: linear
          - base: "10"
            name: y
            scale: linear
        colors:
          - hex: '#00C9FF'
            name: laser
            type: text
        decimalPlaces: 2
        height: 3
        kind: Single_Stat_Plus_Line
        name: Ram usage
        position: overlaid
        queries:
          - query: |-
                from(bucket: v.bucket)
                  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)
                  |> filter(fn: (r) => r["_measurement"] == "mem")
                  |> filter(fn: (r) => r["_field"] == "used_percent")
                  |> filter(fn: (r) => r["host"] == v.hostname)
        width: 5
        xCol: _time
        xPos: 5
        yCol: _value
      - axes:
          - base: "10"
            name: x
            scale: linear
          - base: "10"
            name: y
            scale: linear
        colors:
          - hex: '#00C9FF'
            name: laser
            type: text
        decimalPlaces: 2
        height: 5
        kind: Single_Stat_Plus_Line
        name: Disk usage
        position: overlaid
        queries:
          - query: |-
                from(bucket: v.bucket)
                  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)
                  |> filter(fn: (r) => r["_measurement"] == "disk")
                  |> filter(fn: (r) => r["_field"] == "used_percent")
                  |> filter(fn: (r) => r["host"] == v.hostname)
        width: 4
        xCol: _time
        xPos: 6
        yCol: _value
        yPos: 3
      - colors:
          - hex: '#ffffff'
            name: white
            type: text
        fieldOptions:
          - displayName: URL
            fieldName: _value
            visible: true
        height: 1
        kind: Table
        name: Remote Access
        queries:
          - query: |-
                import "strings"
                from(bucket: v.bucket)
                  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)
                  |> filter(fn: (r) => r["_measurement"] == "exec_meshinfo")
                  |> filter(fn: (r) => r["_field"] == "value")
                  |> filter(fn: (r) => r["host"] == v.hostname)
                  |> last()
                  |> keep(columns: ["_value"])
                  |> map(fn: (r) => ({ r with _value: strings.joinStr(arr: ["https://",v.mesh_info, "/?viewmode=11&gotonode=",r._value], v: "")}))
        tableOptions:
            fixFirstColumn: true
            verticalTimeAxis: true
        timeFormat: YYYY-MM-DD HH:mm:ss
        width: 2
        xPos: 10
      - colors:
          - hex: '#00C9FF'
            name: laser
            type: text
        decimalPlaces: 2
        height: 1
        kind: Single_Stat
        name: Uptime
        queries:
          - query: |-
                from(bucket: "windows")
                  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)
                  |>filter(fn: (r) => r["host"] == v.hostname)
                  |> filter(fn: (r) => r["_measurement"] == "system")
                  |> filter(fn: (r) => r["_field"] == "uptime_format")
        width: 2
        xPos: 10
        yPos: 1
      - colors:
          - hex: '#00C9FF'
            name: laser
            type: text
        decimalPlaces: 2
        height: 1
        kind: Single_Stat
        name: Load 1
        queries:
          - query: |-
                from(bucket: v.bucket)
                  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)
                  |> filter(fn: (r) => r["_measurement"] == "system")
                  |> filter(fn: (r) => r["_field"] == "load5")
                  |> filter(fn: (r) => r["host"] == v.hostname)
        width: 2
        xPos: 10
        yPos: 2
      - colors:
          - hex: '#00C9FF'
            name: laser
            type: text
        decimalPlaces: 2
        height: 1
        kind: Single_Stat
        name: Load 15
        queries:
          - query: |-
                from(bucket: v.bucket)
                  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)
                  |> filter(fn: (r) => r["_measurement"] == "system")
                  |> filter(fn: (r) => r["_field"] == "load5")
                  |> filter(fn: (r) => r["host"] == v.hostname)
        width: 2
        xPos: 10
        yPos: 3
      - colors:
          - hex: '#00C9FF'
            name: laser
            type: text
        decimalPlaces: 0
        height: 1
        kind: Single_Stat
        name: CPU Count
        queries:
          - query: |-
                from(bucket: v.bucket)
                  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)
                  |> filter(fn: (r) => r["_measurement"] == "system")
                  |> filter(fn: (r) => r["_field"] == "n_cpus")
                  |> filter(fn: (r) => r["host"] == v.hostname)
        width: 2
        xPos: 10
        yPos: 4
      - colors:
          - hex: '#00C9FF'
            name: laser
            type: text
        decimalPlaces: 2
        height: 1
        kind: Single_Stat
        name: Memory
        queries:
          - query: |-
                from(bucket: v.bucket)
                  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)
                  |> filter(fn: (r) => r["_measurement"] == "mem")
                  |> filter(fn: (r) => r["host"] == v.hostname)
                  |> filter(fn: (r) => r["_field"] == "total")
                  |> map(fn: (r) => ({
                      r with
                      _value: r._value / 1000000000
                    })
                  )
        width: 2
        xPos: 10
        yPos: 5
      - colors:
          - hex: '#00C9FF'
            name: laser
            type: text
        decimalPlaces: 2
        height: 1
        kind: Single_Stat
        name: Edition
        queries:
          - query: |-
                from(bucket: v.bucket)
                  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)
                  |> filter(fn: (r) => r["_measurement"] == "exec_win_ver")
                  |> filter(fn: (r) => r["_field"] == "Caption")
                  |> filter(fn: (r) => r["host"] == v.hostname)
        width: 2
        xPos: 10
        yPos: 6
      - colors:
          - hex: '#00C9FF'
            name: laser
            type: text
        decimalPlaces: 2
        height: 1
        kind: Single_Stat
        name: Build
        queries:
          - query: |-
                from(bucket: v.bucket)
                  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)
                  |> filter(fn: (r) => r["_measurement"] == "exec_win_ver")
                  |> filter(fn: (r) => r["_field"] == "Version")
                  |> filter(fn: (r) => r["host"] == v.hostname)
        width: 2
        xPos: 10
        yPos: 7
    name: Windows Metrics
