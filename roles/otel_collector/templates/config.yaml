extensions:
  health_check:
  pprof:
    endpoint: 0.0.0.0:1777
  zpages:
    endpoint: 0.0.0.0:55679
  bearertokenauth:
    scheme: "Bearer"
    token: "{{ shiftmon_otel_collector_token }}"
receivers:
  otlp:
    protocols:
      grpc:
        endpoint: 0.0.0.0:4317
      http:
        endpoint: 0.0.0.0:4318
  hostmetrics:
    collection_interval: 10s # default = 1m
    initial_delay: 1s # default = 1s
    root_path: /
    scrapers:
      cpu:
      disk:
      filesystem:
      load:
      memory:
      network:
      paging:
      processes:
      system:
  prometheus:
    config:
      scrape_configs:
      - job_name: 'otel-collector'
        scrape_interval: 10s
        static_configs:
        - targets:
            - '0.0.0.0:8888'
  journald:
    directory: /var/log/journal
  filelog:
    include:
       - /var/log/tetragon/tetragon.log
    operators:
      - type: json_parser
        parse_from: body
processors:
  batch:
  resourcedetection/system:
    detectors:
      - "system"
    system:
      hostname_sources:
        - "os"
        - "dns"
exporters:
  otlphttp/metrics:
    metrics_endpoint: '{{ shiftmon_otlp_metrics_endpoint }}'
    compression: gzip
    encoding: proto
    auth:
      authenticator: bearertokenauth
  otlphttp/logs:
    logs_endpoint: '{{ shiftmon_otlp_logs_endpoint }}'
    compression: gzip
    encoding: proto
    headers:
      VL-Msg-Field: 'MESSAGE'
    auth:
      authenticator: bearertokenauth
  otlphttp/traces:
    traces_endpoint: '{{ shiftmon_otlp_traces_endpoint }}'

service:
  pipelines:
    traces:
      receivers: 
        - otlp
      processors: 
        - batch
        - resourcedetection/system
      exporters:
        - otlphttp/traces
    metrics:
      receivers:
        - otlp
        - hostmetrics
        - prometheus
      processors:
        - batch
        - resourcedetection/system
      exporters: 
        - otlphttp/metrics
    logs:
      receivers:
        - otlp
        - journald
        - filelog
      processors:
        - batch
        - resourcedetection/system
      exporters:
        - otlphttp/logs
  extensions:
    - health_check
    - pprof
    - zpages
    - bearertokenauth
